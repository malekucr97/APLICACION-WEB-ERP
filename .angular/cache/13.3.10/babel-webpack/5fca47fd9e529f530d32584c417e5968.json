{"ast":null,"code":"import { first } from 'rxjs/operators';\nimport { User } from '@app/_models';\nimport { administrator, amdinBusiness, httpAccessAdminPage, httpLandingIndexPage } from '@environments/environment-access-admin';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@app/_services\";\nimport * as i2 from \"@angular/router\";\nimport * as i3 from \"@angular/common\";\n\nfunction ListUserComponent_th_24_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelement(0, \"th\", 8);\n  }\n}\n\nfunction ListUserComponent_tr_26_td_11_button_5_span_1_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelement(0, \"span\", 23);\n  }\n}\n\nfunction ListUserComponent_tr_26_td_11_button_5_span_2_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"span\");\n    i0.ɵɵtext(1, \"Activar cuenta\");\n    i0.ɵɵelementEnd();\n  }\n}\n\nfunction ListUserComponent_tr_26_td_11_button_5_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r12 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"button\", 22);\n    i0.ɵɵlistener(\"click\", function ListUserComponent_tr_26_td_11_button_5_Template_button_click_0_listener() {\n      i0.ɵɵrestoreView(_r12);\n      const us_r2 = i0.ɵɵnextContext(2).$implicit;\n      const ctx_r10 = i0.ɵɵnextContext();\n      return ctx_r10.activateUser(us_r2.identificacion, us_r2.id);\n    });\n    i0.ɵɵtemplate(1, ListUserComponent_tr_26_td_11_button_5_span_1_Template, 1, 0, \"span\", 20);\n    i0.ɵɵtemplate(2, ListUserComponent_tr_26_td_11_button_5_span_2_Template, 2, 0, \"span\", 21);\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const ctx_r4 = i0.ɵɵnextContext(3);\n    i0.ɵɵproperty(\"disabled\", ctx_r4.isActivating);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r4.isActivating);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", !ctx_r4.isActivating);\n  }\n}\n\nfunction ListUserComponent_tr_26_td_11_button_6_span_1_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelement(0, \"span\", 23);\n  }\n}\n\nfunction ListUserComponent_tr_26_td_11_button_6_span_2_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"span\");\n    i0.ɵɵtext(1, \"Inactiv cuenta\");\n    i0.ɵɵelementEnd();\n  }\n}\n\nfunction ListUserComponent_tr_26_td_11_button_6_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r17 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"button\", 24);\n    i0.ɵɵlistener(\"click\", function ListUserComponent_tr_26_td_11_button_6_Template_button_click_0_listener() {\n      i0.ɵɵrestoreView(_r17);\n      const us_r2 = i0.ɵɵnextContext(2).$implicit;\n      const ctx_r15 = i0.ɵɵnextContext();\n      return ctx_r15.inActivateUser(us_r2.identificacion, us_r2.id);\n    });\n    i0.ɵɵtemplate(1, ListUserComponent_tr_26_td_11_button_6_span_1_Template, 1, 0, \"span\", 20);\n    i0.ɵɵtemplate(2, ListUserComponent_tr_26_td_11_button_6_span_2_Template, 2, 0, \"span\", 21);\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const ctx_r5 = i0.ɵɵnextContext(3);\n    i0.ɵɵproperty(\"disabled\", ctx_r5.isActivating);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r5.isActivating);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", !ctx_r5.isActivating);\n  }\n}\n\nfunction ListUserComponent_tr_26_td_11_span_10_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelement(0, \"span\", 23);\n  }\n}\n\nfunction ListUserComponent_tr_26_td_11_span_11_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"span\");\n    i0.ɵɵtext(1, \"Eliminar\");\n    i0.ɵɵelementEnd();\n  }\n}\n\nfunction ListUserComponent_tr_26_td_11_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r20 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"td\", 13)(1, \"a\", 14);\n    i0.ɵɵtext(2, \" Empresa \");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"a\", 15);\n    i0.ɵɵtext(4, \" Rol \");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(5, ListUserComponent_tr_26_td_11_button_5_Template, 3, 3, \"button\", 16);\n    i0.ɵɵtemplate(6, ListUserComponent_tr_26_td_11_button_6_Template, 3, 3, \"button\", 17);\n    i0.ɵɵelementStart(7, \"a\", 18);\n    i0.ɵɵtext(8, \"Actualizar\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(9, \"button\", 19);\n    i0.ɵɵlistener(\"click\", function ListUserComponent_tr_26_td_11_Template_button_click_9_listener() {\n      i0.ɵɵrestoreView(_r20);\n      const us_r2 = i0.ɵɵnextContext().$implicit;\n      const ctx_r18 = i0.ɵɵnextContext();\n      return ctx_r18.deleteUser(us_r2.identificacion, us_r2.id);\n    });\n    i0.ɵɵtemplate(10, ListUserComponent_tr_26_td_11_span_10_Template, 1, 0, \"span\", 20);\n    i0.ɵɵtemplate(11, ListUserComponent_tr_26_td_11_span_11_Template, 2, 0, \"span\", 21);\n    i0.ɵɵelementEnd()();\n  }\n\n  if (rf & 2) {\n    const us_r2 = i0.ɵɵnextContext().$implicit;\n    const ctx_r3 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(1);\n    i0.ɵɵpropertyInterpolate2(\"routerLink\", \"\", ctx_r3.URLAddBusinessUsertPage, \"\", us_r2.identificacion, \"\");\n    i0.ɵɵadvance(2);\n    i0.ɵɵpropertyInterpolate2(\"routerLink\", \"\", ctx_r3.URLAddRoleUsertPage, \"\", us_r2.identificacion, \"\");\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"ngIf\", us_r2.estado != \"Activo\");\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", us_r2.estado == \"Activo\");\n    i0.ɵɵadvance(1);\n    i0.ɵɵpropertyInterpolate2(\"routerLink\", \"\", ctx_r3.URLAddEditUsertPage, \"\", us_r2.identificacion, \"\");\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"disabled\", ctx_r3.isDeleting);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r3.isDeleting);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", !ctx_r3.isDeleting);\n  }\n}\n\nfunction ListUserComponent_tr_26_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"tr\")(1, \"td\");\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"td\");\n    i0.ɵɵtext(4);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(5, \"td\");\n    i0.ɵɵtext(6);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(7, \"td\");\n    i0.ɵɵtext(8);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(9, \"td\");\n    i0.ɵɵtext(10);\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(11, ListUserComponent_tr_26_td_11_Template, 12, 11, \"td\", 12);\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const us_r2 = ctx.$implicit;\n    const ctx_r1 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(us_r2.identificacion);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(us_r2.nombreCompleto);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(us_r2.email);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(us_r2.idRol);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(us_r2.estado);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r1.userObservable.esAdmin);\n  }\n}\n\nexport let ListUserComponent = /*#__PURE__*/(() => {\n  class ListUserComponent {\n    constructor(accountService, alertService, router) {\n      this.accountService = accountService;\n      this.alertService = alertService;\n      this.router = router;\n      this.listUsers = [];\n      this.isActivating = false;\n      this.isDeleting = false;\n      this.Home = httpLandingIndexPage.homeHTTP;\n      this.URLAddEditUsertPage = httpAccessAdminPage.urlPageAddEditUser;\n      this.URLAddBusinessUsertPage = httpAccessAdminPage.urlPageAddBUser;\n      this.URLAddRoleUsertPage = httpAccessAdminPage.urlPageAddRUser;\n      this.URLAdministratorPage = httpAccessAdminPage.urlPageAdministrator;\n      this.userObservable = this.accountService.userValue;\n      this.businessObservable = this.accountService.businessValue;\n    }\n\n    ngOnInit() {\n      if (!this.businessObservable) {\n        this.router.navigate([this.Home]);\n        return;\n      }\n\n      if (this.userObservable.esAdmin) {\n        this.accountService.getAllUsers().pipe(first()).subscribe(users => {\n          this.listUsers = users;\n          this.accountService.suscribeListUser(this.listUsers);\n        });\n      } else if (this.userObservable.idRol && this.userObservable.idRol === amdinBusiness.adminSociedad) {\n        this.accountService.getUsersBusiness(this.userObservable.empresa).pipe(first()).subscribe(users => {\n          this.listUsers = users;\n          this.accountService.suscribeListUser(this.listUsers);\n        });\n      } else {\n        this.router.navigate([this.Home]);\n      }\n    }\n\n    deleteUser(identificacionUsuario, idUser) {\n      this.alertService.clear();\n\n      if (identificacionUsuario !== administrator.id) {\n        this.isDeleting = true;\n        this.accountService.deleteUser(idUser).pipe(first()).subscribe(responseDelete => {\n          if (responseDelete.exito) {\n            this.alertService.success(responseDelete.responseMesagge, {\n              keepAfterRouteChange: false\n            });\n            this.listUsers.splice(this.listUsers.findIndex(u => u.id == idUser), 1);\n          } else {\n            this.alertService.warn('No se puede eliminar un usuario con acceso a una compañía.', {\n              keepAfterRouteChange: false\n            });\n            console.log(responseDelete.responseMesagge);\n          }\n\n          this.isDeleting = false;\n        }, error => {\n          this.isDeleting = false;\n          this.alertService.error(error.message, {\n            keepAfterRouteChange: false\n          });\n        });\n      } else {\n        let message = 'No se puede eliminar la cuenta administradora del sistema';\n        this.alertService.info(message, {\n          keepAfterRouteChange: false\n        });\n      }\n    }\n\n    activateUser(identificacion, idUser) {\n      this.alertService.clear();\n\n      if (identificacion !== administrator.id) {\n        this.isActivating = true;\n        let userList = this.listUsers.find(x => x.id === idUser);\n        let userUpdate = new User();\n        userUpdate.id = idUser;\n        this.accountService.activateUser(userUpdate).pipe(first()).subscribe(responseActivate => {\n          if (responseActivate.exito) {\n            userList.estado = 'Activo';\n            this.listUsers[this.listUsers.findIndex(u => u.id == idUser)] = userList;\n            this.alertService.success(responseActivate.responseMesagge, {\n              keepAfterRouteChange: false\n            });\n          } else {\n            this.alertService.warn('Problemas al activar el usuario. Error: ' + responseActivate.responseMesagge, {\n              keepAfterRouteChange: false\n            });\n          }\n\n          this.isActivating = false;\n        }, error => {\n          this.isActivating = false;\n          this.alertService.error(error, {\n            keepAfterRouteChange: false\n          });\n        });\n      } else {\n        let message = 'No se puede modificar el estado de la cuenta administradora del sistema';\n        this.alertService.info(message, {\n          keepAfterRouteChange: false\n        });\n      }\n    }\n\n    inActivateUser(identificacion, idUser) {\n      this.alertService.clear();\n\n      if (identificacion !== administrator.id) {\n        this.isActivating = true;\n        let userList = this.listUsers.find(x => x.id === idUser);\n        let userUpdate = new User();\n        userUpdate.id = idUser;\n        this.accountService.inActivateUser(userUpdate).pipe(first()).subscribe(responseInActivate => {\n          if (responseInActivate.exito) {\n            userList.estado = 'Inactivo';\n            this.listUsers[this.listUsers.findIndex(u => u.id == idUser)] = userList;\n            this.alertService.success(responseInActivate.responseMesagge, {\n              keepAfterRouteChange: false\n            });\n          } else {\n            this.alertService.warn('Problemas al inactivar el usuario. Error: ' + responseInActivate.responseMesagge, {\n              keepAfterRouteChange: false\n            });\n          }\n\n          this.isActivating = false;\n        }, error => {\n          this.isActivating = false;\n          this.alertService.error(error, {\n            keepAfterRouteChange: false\n          });\n        });\n      } else {\n        let message = 'No se puede modificar el estado de la cuenta administradora del sistema';\n        this.alertService.info(message, {\n          keepAfterRouteChange: false\n        });\n      }\n    }\n\n  }\n\n  ListUserComponent.ɵfac = function ListUserComponent_Factory(t) {\n    return new (t || ListUserComponent)(i0.ɵɵdirectiveInject(i1.AccountService), i0.ɵɵdirectiveInject(i1.AlertService), i0.ɵɵdirectiveInject(i2.Router));\n  };\n\n  ListUserComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: ListUserComponent,\n    selectors: [[\"ng-component\"]],\n    decls: 27,\n    vars: 4,\n    consts: [[2, \"color\", \"#1A5276\"], [1, \"btn\", \"btn-light\", \"mb-2\", \"mr-3\", 3, \"routerLink\"], [1, \"card\"], [1, \"card-body\"], [1, \"btn\", \"btn-sm\", \"btn-success\", \"mb-3\", \"mr-3\", \"float-right\", 3, \"routerLink\"], [1, \"table\", \"table-striped\"], [2, \"width\", \"5%\"], [2, \"width\", \"25%\"], [2, \"width\", \"20%\"], [2, \"width\", \"10%\"], [\"style\", \"width: 20%\", 4, \"ngIf\"], [4, \"ngFor\", \"ngForOf\"], [\"style\", \"white-space: nowrap\", 4, \"ngIf\"], [2, \"white-space\", \"nowrap\"], [1, \"btn\", \"btn-sm\", \"btn-outline-dark\", \"mr-1\", 3, \"routerLink\"], [1, \"btn\", \"btn-sm\", \"btn-dark\", \"mr-1\", 3, \"routerLink\"], [\"class\", \"btn btn-sm btn-light mr-1\", 3, \"disabled\", \"click\", 4, \"ngIf\"], [\"class\", \"btn btn-sm btn-info mr-1\", 3, \"disabled\", \"click\", 4, \"ngIf\"], [1, \"btn\", \"btn-sm\", \"btn-warning\", \"mr-1\", 3, \"routerLink\"], [1, \"btn\", \"btn-sm\", \"btn-outline-danger\", \"mr-1\", 3, \"disabled\", \"click\"], [\"class\", \"spinner-border spinner-border-sm\", 4, \"ngIf\"], [4, \"ngIf\"], [1, \"btn\", \"btn-sm\", \"btn-light\", \"mr-1\", 3, \"disabled\", \"click\"], [1, \"spinner-border\", \"spinner-border-sm\"], [1, \"btn\", \"btn-sm\", \"btn-info\", \"mr-1\", 3, \"disabled\", \"click\"]],\n    template: function ListUserComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵelementStart(0, \"h1\", 0);\n        i0.ɵɵtext(1, \"Usuarios\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(2, \"h4\");\n        i0.ɵɵtext(3, \"Lista de de usuarios registrados en el sistema\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(4, \"a\", 1);\n        i0.ɵɵtext(5, \"Volver\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelement(6, \"br\");\n        i0.ɵɵelementStart(7, \"div\", 2)(8, \"div\", 3)(9, \"a\", 4);\n        i0.ɵɵtext(10, \"Registrar Usuario\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(11, \"table\", 5)(12, \"thead\")(13, \"tr\")(14, \"th\", 6);\n        i0.ɵɵtext(15, \"Identificaci\\u00F3n\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(16, \"th\", 7);\n        i0.ɵɵtext(17, \"Nombre\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(18, \"th\", 8);\n        i0.ɵɵtext(19, \"Email\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(20, \"th\", 9);\n        i0.ɵɵtext(21, \"Rol\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(22, \"th\", 9);\n        i0.ɵɵtext(23, \"Estado\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵtemplate(24, ListUserComponent_th_24_Template, 1, 0, \"th\", 10);\n        i0.ɵɵelementEnd()();\n        i0.ɵɵelementStart(25, \"tbody\");\n        i0.ɵɵtemplate(26, ListUserComponent_tr_26_Template, 12, 6, \"tr\", 11);\n        i0.ɵɵelementEnd()()()();\n      }\n\n      if (rf & 2) {\n        i0.ɵɵadvance(4);\n        i0.ɵɵpropertyInterpolate(\"routerLink\", ctx.URLAdministratorPage);\n        i0.ɵɵadvance(5);\n        i0.ɵɵpropertyInterpolate(\"routerLink\", ctx.URLAddEditUsertPage);\n        i0.ɵɵadvance(15);\n        i0.ɵɵproperty(\"ngIf\", ctx.userObservable.esAdmin);\n        i0.ɵɵadvance(2);\n        i0.ɵɵproperty(\"ngForOf\", ctx.listUsers);\n      }\n    },\n    directives: [i2.RouterLinkWithHref, i3.NgIf, i3.NgForOf],\n    encapsulation: 2\n  });\n  return ListUserComponent;\n})();","map":null,"metadata":{},"sourceType":"module"}